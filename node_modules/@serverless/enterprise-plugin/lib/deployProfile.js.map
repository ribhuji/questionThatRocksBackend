{"version":3,"sources":["../../lib/deployProfile.js"],"names":["require","getAccessKeyForTenant","getDeployProfile","module","exports","configureDeployProfile","ctx","accessKey","sls","service","org","deploymentProfile","stage","provider","getStage","app","tenant","providerCredentials","cachedCredentials","secretValue","region","getRegion","safeguards","safeguardsPolicies"],"mappings":"AAAA;;;;;;iBAEoDA,OAAO,CAAC,0BAAD,C;MAAnDC,qB,YAAAA,qB;MAAuBC,gB,YAAAA,gB;;AAE/BC,MAAM,CAACC,OAAP,CAAeC,sBAAf;AAAA,+BAAwC,WAAOC,GAAP,EAAe;AACrD,UAAMC,SAAS,SAASN,qBAAqB,CAACK,GAAG,CAACE,GAAJ,CAAQC,OAAR,CAAgBC,GAAjB,CAA7C;AACA,UAAMC,iBAAiB,SAAST,gBAAgB,CAAC;AAC/CK,MAAAA,SAD+C;AAE/CK,MAAAA,KAAK,EAAEN,GAAG,CAACO,QAAJ,CAAaC,QAAb,EAFwC;AAG/CC,MAAAA,GAAG,EAAET,GAAG,CAACE,GAAJ,CAAQC,OAAR,CAAgBM,GAH0B;AAI/CC,MAAAA,MAAM,EAAEV,GAAG,CAACE,GAAJ,CAAQC,OAAR,CAAgBC;AAJuB,KAAD,CAAhD;;AAMA,QAAIC,iBAAiB,CAACM,mBAAtB,EAA2C;AACzCX,MAAAA,GAAG,CAACO,QAAJ,CAAaK,iBAAb,GAAiCP,iBAAiB,CAACM,mBAAlB,CAAsCE,WAAvE;AACAb,MAAAA,GAAG,CAACO,QAAJ,CAAaK,iBAAb,CAA+BE,MAA/B,GAAwCd,GAAG,CAACO,QAAJ,CAAaQ,SAAb,EAAxC;AACD;;AACDf,IAAAA,GAAG,CAACgB,UAAJ,GAAiBX,iBAAiB,CAACY,kBAAnC;AACD,GAbD;;AAAA;AAAA;AAAA;AAAA","sourcesContent":["'use strict';\n\nconst { getAccessKeyForTenant, getDeployProfile } = require('@serverless/platform-sdk');\n\nmodule.exports.configureDeployProfile = async (ctx) => {\n  const accessKey = await getAccessKeyForTenant(ctx.sls.service.org);\n  const deploymentProfile = await getDeployProfile({\n    accessKey,\n    stage: ctx.provider.getStage(),\n    app: ctx.sls.service.app,\n    tenant: ctx.sls.service.org,\n  });\n  if (deploymentProfile.providerCredentials) {\n    ctx.provider.cachedCredentials = deploymentProfile.providerCredentials.secretValue;\n    ctx.provider.cachedCredentials.region = ctx.provider.getRegion();\n  }\n  ctx.safeguards = deploymentProfile.safeguardsPolicies;\n};\n"],"file":"deployProfile.js"}