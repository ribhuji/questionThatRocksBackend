{"version":3,"sources":["../../../../lib/safeguards/policies/allowed-stages.js"],"names":["module","exports","allowedStagePolicy","policy","service","options","stageName","provider","getStage","match","fail","approve","Object","keys","i","JSON","stringify","docs"],"mappings":"AAAA;;AAEAA,MAAM,CAACC,OAAP,GAAiB,SAASC,kBAAT,CAA4BC,MAA5B,EAAoCC,OAApC,EAA6CC,OAA7C,EAAsD;AACrE,QAAMC,SAAS,GAAGF,OAAO,CAACG,QAAR,CAAiBC,QAAjB,EAAlB;;AACA,MAAI,OAAOH,OAAP,KAAmB,QAAvB,EAAiC;AAC/B,QAAI,CAACC,SAAS,CAACG,KAAV,CAAgBJ,OAAhB,CAAL,EAA+B;AAC7BF,MAAAA,MAAM,CAACO,IAAP,CAAa,eAAcJ,SAAU,+BAA8BD,OAAQ,GAA3E;AACD,KAFD,MAEO;AACLF,MAAAA,MAAM,CAACQ,OAAP;AACD;AACF,GAND,MAMO;AACL,oCAAgBC,MAAM,CAACC,IAAP,CAAYR,OAAZ,CAAhB,kCAAsC;AAAjC,YAAMS,CAAC,mBAAP;;AACH,UAAIT,OAAO,CAACS,CAAD,CAAP,KAAeR,SAAnB,EAA8B;AAC5BH,QAAAA,MAAM,CAACQ,OAAP;AACA;AACD;AACF;;AACDR,IAAAA,MAAM,CAACO,IAAP,CACG,eAAcJ,SAAU,qCAAoCS,IAAI,CAACC,SAAL,CAAeX,OAAf,CAAwB,EADvF;AAGD;AACF,CAnBD;;AAqBAL,MAAM,CAACC,OAAP,CAAegB,IAAf,GAAsB,kCAAtB","sourcesContent":["'use strict';\n\nmodule.exports = function allowedStagePolicy(policy, service, options) {\n  const stageName = service.provider.getStage();\n  if (typeof options === 'string') {\n    if (!stageName.match(options)) {\n      policy.fail(`Stage name \"${stageName}\" not permitted by RegExp: \"${options}\"`);\n    } else {\n      policy.approve();\n    }\n  } else {\n    for (const i of Object.keys(options)) {\n      if (options[i] === stageName) {\n        policy.approve();\n        return;\n      }\n    }\n    policy.fail(\n      `Stage name \"${stageName}\" not in list of permitted names: ${JSON.stringify(options)}`\n    );\n  }\n};\n\nmodule.exports.docs = 'http://slss.io/sg-allowed-stages';\n"],"file":"allowed-stages.js"}