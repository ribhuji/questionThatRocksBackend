{"version":3,"sources":["../../../../lib/safeguards/policies/forbid-lambda-apig-integration.js"],"names":["allowedIntegrationTypes","module","exports","allowedRuntimesPolicy","policy","service","failed","Object","keys","declaration","functions","fnName","events","eventTrigger","http","includes","integration","toUpperCase","replace","fail","approve","docs"],"mappings":"AAAA;;;;;;;;AAEA,MAAMA,uBAAuB,GAAG,CAAC,cAAD,EAAiB,WAAjB,CAAhC;;AAEAC,MAAM,CAACC,OAAP,GAAiB,SAASC,qBAAT,CAA+BC,MAA/B,EAAuCC,OAAvC,EAAgD;AAC/D,MAAIC,MAAM,GAAG,KAAb;;AACA,kCAAqBC,MAAM,CAACC,IAAP,CAAYH,OAAO,CAACI,WAAR,CAAoBC,SAAhC,CAArB,kCAAiE;AAA5D,UAAMC,MAAM,mBAAZ;;AAA4D,+CACpCN,OAAO,CAACI,WAAR,CAAoBC,SAApB,CAA8BC,MAA9B,EAAsCC,MAAtC,IAAgD,EADZ;AAAA;;AAAA;AAC/D,0DAA+E;AAAA,cAApEC,YAAoE;;AAC7E,YACEA,YAAY,CAACC,IAAb,IACA,CAACd,uBAAuB,CAACe,QAAxB,CACC,CAACF,YAAY,CAACC,IAAb,CAAkBE,WAAlB,IAAiC,cAAlC,EAAkDC,WAAlD,GAAgEC,OAAhE,CAAwE,GAAxE,EAA6E,GAA7E,CADD,CAFH,EAKE;AACAZ,UAAAA,MAAM,GAAG,IAAT;AACAF,UAAAA,MAAM,CAACe,IAAP,CACG,aAAYR,MAAO,gCAA+BE,YAAY,CAACC,IAAb,CAAkBE,WAAY,sEADnF;AAGD;AACF;AAb8D;AAAA;AAAA;AAAA;AAAA;AAchE;;AACD,MAAI,CAACV,MAAL,EAAa;AACXF,IAAAA,MAAM,CAACgB,OAAP;AACD;AACF,CApBD;;AAsBAnB,MAAM,CAACC,OAAP,CAAemB,IAAf,GAAsB,kDAAtB","sourcesContent":["'use strict';\n\nconst allowedIntegrationTypes = ['LAMBDA_PROXY', 'AWS_PROXY'];\n\nmodule.exports = function allowedRuntimesPolicy(policy, service) {\n  let failed = false;\n  for (const fnName of Object.keys(service.declaration.functions)) {\n    for (const eventTrigger of service.declaration.functions[fnName].events || []) {\n      if (\n        eventTrigger.http &&\n        !allowedIntegrationTypes.includes(\n          (eventTrigger.http.integration || 'LAMBDA_PROXY').toUpperCase().replace('-', '_')\n        )\n      ) {\n        failed = true;\n        policy.fail(\n          `Function \"${fnName}\" is using HTTP integration \"${eventTrigger.http.integration}\" which does not support instrumentation by the Serverless Dashboard`\n        );\n      }\n    }\n  }\n  if (!failed) {\n    policy.approve();\n  }\n};\n\nmodule.exports.docs = 'http://slss.io/sg-forbid-lambda-apig-integration';\n"],"file":"forbid-lambda-apig-integration.js"}